var Xt=Object.create;var Me=Object.defineProperty;var Yt=Object.getOwnPropertyDescriptor;var Qt=Object.getOwnPropertyNames;var Kt=Object.getPrototypeOf,es=Object.prototype.hasOwnProperty;var De=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var ie=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),ts=(r,e)=>{for(var t in e)Me(r,t,{get:e[t],enumerable:!0})},ss=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Qt(e))!es.call(r,i)&&i!==t&&Me(r,i,{get:()=>e[i],enumerable:!(s=Yt(e,i))||s.enumerable});return r};var Q=(r,e,t)=>(t=r!=null?Xt(Kt(r)):{},ss(e||!r||!r.__esModule?Me(t,"default",{value:r,enumerable:!0}):t,r));var at=ie((Ei,ot)=>{var ne=1e3,oe=ne*60,ae=oe*60,K=ae*24,rs=K*7,is=K*365.25;ot.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return ns(r);if(t==="number"&&isFinite(r))return e.long?as(r):os(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function ns(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),s=(e[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return t*is;case"weeks":case"week":case"w":return t*rs;case"days":case"day":case"d":return t*K;case"hours":case"hour":case"hrs":case"hr":case"h":return t*ae;case"minutes":case"minute":case"mins":case"min":case"m":return t*oe;case"seconds":case"second":case"secs":case"sec":case"s":return t*ne;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function os(r){var e=Math.abs(r);return e>=K?Math.round(r/K)+"d":e>=ae?Math.round(r/ae)+"h":e>=oe?Math.round(r/oe)+"m":e>=ne?Math.round(r/ne)+"s":r+"ms"}function as(r){var e=Math.abs(r);return e>=K?Te(r,e,K,"day"):e>=ae?Te(r,e,ae,"hour"):e>=oe?Te(r,e,oe,"minute"):e>=ne?Te(r,e,ne,"second"):r+" ms"}function Te(r,e,t,s){var i=e>=t*1.5;return Math.round(r/t)+" "+s+(i?"s":"")}});var We=ie((Li,ct)=>{function cs(r){t.debug=t,t.default=t,t.coerce=f,t.disable=n,t.enable=i,t.enabled=o,t.humanize=at(),t.destroy=l,Object.keys(r).forEach(a=>{t[a]=r[a]}),t.names=[],t.skips=[],t.formatters={};function e(a){let h=0;for(let d=0;d<a.length;d++)h=(h<<5)-h+a.charCodeAt(d),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=e;function t(a){let h,d=null,m,b;function g(...u){if(!g.enabled)return;let _=g,E=Number(new Date),v=E-(h||E);_.diff=v,_.prev=h,_.curr=E,h=E,u[0]=t.coerce(u[0]),typeof u[0]!="string"&&u.unshift("%O");let T=0;u[0]=u[0].replace(/%([a-zA-Z%])/g,(y,w)=>{if(y==="%%")return"%";T++;let x=t.formatters[w];if(typeof x=="function"){let $=u[T];y=x.call(_,$),u.splice(T,1),T--}return y}),t.formatArgs.call(_,u),(_.log||t.log).apply(_,u)}return g.namespace=a,g.useColors=t.useColors(),g.color=t.selectColor(a),g.extend=s,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(m!==t.namespaces&&(m=t.namespaces,b=t.enabled(a)),b),set:u=>{d=u}}),typeof t.init=="function"&&t.init(g),g}function s(a,h){let d=t(this.namespace+(typeof h>"u"?":":h)+a);return d.log=this.log,d}function i(a){t.save(a),t.namespaces=a,t.names=[],t.skips=[];let h,d=(typeof a=="string"?a:"").split(/[\s,]+/),m=d.length;for(h=0;h<m;h++)d[h]&&(a=d[h].replace(/\*/g,".*?"),a[0]==="-"?t.skips.push(new RegExp("^"+a.slice(1)+"$")):t.names.push(new RegExp("^"+a+"$")))}function n(){let a=[...t.names.map(c),...t.skips.map(c).map(h=>"-"+h)].join(",");return t.enable(""),a}function o(a){if(a[a.length-1]==="*")return!0;let h,d;for(h=0,d=t.skips.length;h<d;h++)if(t.skips[h].test(a))return!1;for(h=0,d=t.names.length;h<d;h++)if(t.names[h].test(a))return!0;return!1}function c(a){return a.toString().substring(2,a.toString().length-2).replace(/\.\*\?$/,"*")}function f(a){return a instanceof Error?a.stack||a.message:a}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}ct.exports=cs});var ht=ie((F,ve)=>{F.formatArgs=ls;F.save=ds;F.load=fs;F.useColors=hs;F.storage=us();F.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();F.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function hs(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function ls(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+ve.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,s=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(s=t))}),r.splice(s,0,e)}F.log=console.debug||console.log||(()=>{});function ds(r){try{r?F.storage.setItem("debug",r):F.storage.removeItem("debug")}catch{}}function fs(){let r;try{r=F.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function us(){try{return localStorage}catch{}}ve.exports=We()(F);var{formatters:ps}=ve.exports;ps.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var dt=ie((A,Ae)=>{var ms=De("tty"),Se=De("util");A.init=Ts;A.log=ws;A.formatArgs=ys;A.save=_s;A.load=Cs;A.useColors=gs;A.destroy=Se.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");A.colors=[6,2,3,4,5,1];try{let r=De("supports-color");r&&(r.stderr||r).level>=2&&(A.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}A.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,n)=>n.toUpperCase()),s=process.env[e];return/^(yes|on|true|enabled)$/i.test(s)?s=!0:/^(no|off|false|disabled)$/i.test(s)?s=!1:s==="null"?s=null:s=Number(s),r[t]=s,r},{});function gs(){return"colors"in A.inspectOpts?!!A.inspectOpts.colors:ms.isatty(process.stderr.fd)}function ys(r){let{namespace:e,useColors:t}=this;if(t){let s=this.color,i="\x1B[3"+(s<8?s:"8;5;"+s),n=`  ${i};1m${e} \x1B[0m`;r[0]=n+r[0].split(`
`).join(`
`+n),r.push(i+"m+"+Ae.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=bs()+e+" "+r[0]}function bs(){return A.inspectOpts.hideDate?"":new Date().toISOString()+" "}function ws(...r){return process.stderr.write(Se.format(...r)+`
`)}function _s(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function Cs(){return process.env.DEBUG}function Ts(r){r.inspectOpts={};let e=Object.keys(A.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=A.inspectOpts[e[t]]}Ae.exports=We()(A);var{formatters:lt}=Ae.exports;lt.o=function(r){return this.inspectOpts.colors=this.useColors,Se.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};lt.O=function(r){return this.inspectOpts.colors=this.useColors,Se.inspect(r,this.inspectOpts)}});var ee=ie((xi,je)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?je.exports=ht():je.exports=dt()});var Et=ie((ln,At)=>{"use strict";var Qs=new Set([200,203,204,206,300,301,308,404,405,410,414,501]),Ks=new Set([200,203,204,300,301,302,303,307,308,404,405,410,414,501]),er=new Set([500,502,503,504]),tr={date:!0,connection:!0,"keep-alive":!0,"proxy-authenticate":!0,"proxy-authorization":!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0},sr={"content-length":!0,"content-encoding":!0,"transfer-encoding":!0,"content-range":!0};function se(r){let e=parseInt(r,10);return isFinite(e)?e:0}function rr(r){return r?er.has(r.status):!0}function Ye(r){let e={};if(!r)return e;let t=r.trim().split(/,/);for(let s of t){let[i,n]=s.split(/=/,2);e[i.trim()]=n===void 0?!0:n.trim().replace(/^"|"$/g,"")}return e}function ir(r){let e=[];for(let t in r){let s=r[t];e.push(s===!0?t:t+"="+s)}if(e.length)return e.join(", ")}At.exports=class{constructor(e,t,{shared:s,cacheHeuristic:i,immutableMinTimeToLive:n,ignoreCargoCult:o,_fromObject:c}={}){if(c){this._fromObject(c);return}if(!t||!t.headers)throw Error("Response headers missing");this._assertRequestHasHeaders(e),this._responseTime=this.now(),this._isShared=s!==!1,this._cacheHeuristic=i!==void 0?i:.1,this._immutableMinTtl=n!==void 0?n:24*3600*1e3,this._status="status"in t?t.status:200,this._resHeaders=t.headers,this._rescc=Ye(t.headers["cache-control"]),this._method="method"in e?e.method:"GET",this._url=e.url,this._host=e.headers.host,this._noAuthorization=!e.headers.authorization,this._reqHeaders=t.headers.vary?e.headers:null,this._reqcc=Ye(e.headers["cache-control"]),o&&"pre-check"in this._rescc&&"post-check"in this._rescc&&(delete this._rescc["pre-check"],delete this._rescc["post-check"],delete this._rescc["no-cache"],delete this._rescc["no-store"],delete this._rescc["must-revalidate"],this._resHeaders=Object.assign({},this._resHeaders,{"cache-control":ir(this._rescc)}),delete this._resHeaders.expires,delete this._resHeaders.pragma),t.headers["cache-control"]==null&&/no-cache/.test(t.headers.pragma)&&(this._rescc["no-cache"]=!0)}now(){return Date.now()}storable(){return!!(!this._reqcc["no-store"]&&(this._method==="GET"||this._method==="HEAD"||this._method==="POST"&&this._hasExplicitExpiration())&&Ks.has(this._status)&&!this._rescc["no-store"]&&(!this._isShared||!this._rescc.private)&&(!this._isShared||this._noAuthorization||this._allowsStoringAuthenticated())&&(this._resHeaders.expires||this._rescc["max-age"]||this._isShared&&this._rescc["s-maxage"]||this._rescc.public||Qs.has(this._status)))}_hasExplicitExpiration(){return this._isShared&&this._rescc["s-maxage"]||this._rescc["max-age"]||this._resHeaders.expires}_assertRequestHasHeaders(e){if(!e||!e.headers)throw Error("Request headers missing")}satisfiesWithoutRevalidation(e){this._assertRequestHasHeaders(e);let t=Ye(e.headers["cache-control"]);return t["no-cache"]||/no-cache/.test(e.headers.pragma)||t["max-age"]&&this.age()>t["max-age"]||t["min-fresh"]&&this.timeToLive()<1e3*t["min-fresh"]||this.stale()&&!(t["max-stale"]&&!this._rescc["must-revalidate"]&&(t["max-stale"]===!0||t["max-stale"]>this.age()-this.maxAge()))?!1:this._requestMatches(e,!1)}_requestMatches(e,t){return(!this._url||this._url===e.url)&&this._host===e.headers.host&&(!e.method||this._method===e.method||t&&e.method==="HEAD")&&this._varyMatches(e)}_allowsStoringAuthenticated(){return this._rescc["must-revalidate"]||this._rescc.public||this._rescc["s-maxage"]}_varyMatches(e){if(!this._resHeaders.vary)return!0;if(this._resHeaders.vary==="*")return!1;let t=this._resHeaders.vary.trim().toLowerCase().split(/\s*,\s*/);for(let s of t)if(e.headers[s]!==this._reqHeaders[s])return!1;return!0}_copyWithoutHopByHopHeaders(e){let t={};for(let s in e)tr[s]||(t[s]=e[s]);if(e.connection){let s=e.connection.trim().split(/\s*,\s*/);for(let i of s)delete t[i]}if(t.warning){let s=t.warning.split(/,/).filter(i=>!/^\s*1[0-9][0-9]/.test(i));s.length?t.warning=s.join(",").trim():delete t.warning}return t}responseHeaders(){let e=this._copyWithoutHopByHopHeaders(this._resHeaders),t=this.age();return t>3600*24&&!this._hasExplicitExpiration()&&this.maxAge()>3600*24&&(e.warning=(e.warning?`${e.warning}, `:"")+'113 - "rfc7234 5.5.4"'),e.age=`${Math.round(t)}`,e.date=new Date(this.now()).toUTCString(),e}date(){let e=Date.parse(this._resHeaders.date);return isFinite(e)?e:this._responseTime}age(){let e=this._ageValue(),t=(this.now()-this._responseTime)/1e3;return e+t}_ageValue(){return se(this._resHeaders.age)}maxAge(){if(!this.storable()||this._rescc["no-cache"]||this._isShared&&this._resHeaders["set-cookie"]&&!this._rescc.public&&!this._rescc.immutable||this._resHeaders.vary==="*")return 0;if(this._isShared){if(this._rescc["proxy-revalidate"])return 0;if(this._rescc["s-maxage"])return se(this._rescc["s-maxage"])}if(this._rescc["max-age"])return se(this._rescc["max-age"]);let e=this._rescc.immutable?this._immutableMinTtl:0,t=this.date();if(this._resHeaders.expires){let s=Date.parse(this._resHeaders.expires);return Number.isNaN(s)||s<t?0:Math.max(e,(s-t)/1e3)}if(this._resHeaders["last-modified"]){let s=Date.parse(this._resHeaders["last-modified"]);if(isFinite(s)&&t>s)return Math.max(e,(t-s)/1e3*this._cacheHeuristic)}return e}timeToLive(){let e=this.maxAge()-this.age(),t=e+se(this._rescc["stale-if-error"]),s=e+se(this._rescc["stale-while-revalidate"]);return Math.max(0,e,t,s)*1e3}stale(){return this.maxAge()<=this.age()}_useStaleIfError(){return this.maxAge()+se(this._rescc["stale-if-error"])>this.age()}useStaleWhileRevalidate(){return this.maxAge()+se(this._rescc["stale-while-revalidate"])>this.age()}static fromObject(e){return new this(void 0,void 0,{_fromObject:e})}_fromObject(e){if(this._responseTime)throw Error("Reinitialized");if(!e||e.v!==1)throw Error("Invalid serialization");this._responseTime=e.t,this._isShared=e.sh,this._cacheHeuristic=e.ch,this._immutableMinTtl=e.imm!==void 0?e.imm:24*3600*1e3,this._status=e.st,this._resHeaders=e.resh,this._rescc=e.rescc,this._method=e.m,this._url=e.u,this._host=e.h,this._noAuthorization=e.a,this._reqHeaders=e.reqh,this._reqcc=e.reqcc}toObject(){return{v:1,t:this._responseTime,sh:this._isShared,ch:this._cacheHeuristic,imm:this._immutableMinTtl,st:this._status,resh:this._resHeaders,rescc:this._rescc,m:this._method,u:this._url,h:this._host,a:this._noAuthorization,reqh:this._reqHeaders,reqcc:this._reqcc}}revalidationHeaders(e){this._assertRequestHasHeaders(e);let t=this._copyWithoutHopByHopHeaders(e.headers);if(delete t["if-range"],!this._requestMatches(e,!0)||!this.storable())return delete t["if-none-match"],delete t["if-modified-since"],t;if(this._resHeaders.etag&&(t["if-none-match"]=t["if-none-match"]?`${t["if-none-match"]}, ${this._resHeaders.etag}`:this._resHeaders.etag),t["accept-ranges"]||t["if-match"]||t["if-unmodified-since"]||this._method&&this._method!="GET"){if(delete t["if-modified-since"],t["if-none-match"]){let i=t["if-none-match"].split(/,/).filter(n=>!/^\s*W\//.test(n));i.length?t["if-none-match"]=i.join(",").trim():delete t["if-none-match"]}}else this._resHeaders["last-modified"]&&!t["if-modified-since"]&&(t["if-modified-since"]=this._resHeaders["last-modified"]);return t}revalidatedPolicy(e,t){if(this._assertRequestHasHeaders(e),this._useStaleIfError()&&rr(t))return{modified:!1,matches:!1,policy:this};if(!t||!t.headers)throw Error("Response headers missing");let s=!1;if(t.status!==void 0&&t.status!=304?s=!1:t.headers.etag&&!/^\s*W\//.test(t.headers.etag)?s=this._resHeaders.etag&&this._resHeaders.etag.replace(/^\s*W\//,"")===t.headers.etag:this._resHeaders.etag&&t.headers.etag?s=this._resHeaders.etag.replace(/^\s*W\//,"")===t.headers.etag.replace(/^\s*W\//,""):this._resHeaders["last-modified"]?s=this._resHeaders["last-modified"]===t.headers["last-modified"]:!this._resHeaders.etag&&!this._resHeaders["last-modified"]&&!t.headers.etag&&!t.headers["last-modified"]&&(s=!0),!s)return{policy:new this.constructor(e,t),modified:t.status!=304,matches:!1};let i={};for(let o in this._resHeaders)i[o]=o in t.headers&&!sr[o]?t.headers[o]:this._resHeaders[o];let n=Object.assign({},t,{status:this._status,method:this._method,headers:i});return{policy:new this.constructor(e,n,{shared:this._isShared,cacheHeuristic:this._cacheHeuristic,immutableMinTimeToLive:this._immutableMinTtl}),modified:!1,matches:!0}}}});var nt={};ts(nt,{ALPNProtocol:()=>Yr,ALPN_HTTP1_0:()=>Si,ALPN_HTTP1_1:()=>vi,ALPN_HTTP2:()=>Ci,ALPN_HTTP2C:()=>Ti,AbortController:()=>gi,AbortError:()=>yi,AbortSignal:()=>bi,Body:()=>fi,FetchBaseError:()=>wi,FetchError:()=>_i,Headers:()=>ui,Request:()=>pi,Response:()=>mi,cacheStats:()=>oi,clearCache:()=>ai,context:()=>Kr,createUrl:()=>li,fetch:()=>Qr,h1:()=>si,h1NoCache:()=>ii,keepAlive:()=>ri,keepAliveNoCache:()=>ni,noCache:()=>ti,offPush:()=>ci,onPush:()=>hi,reset:()=>ei,timeoutSignal:()=>di});var Vt=Q(ee(),1);import{EventEmitter as Wr}from"events";import{Readable as _e}from"stream";var ue=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,vs=typeof AbortController=="function",Ee=vs?AbortController:class{constructor(){this.signal=new ft}abort(e=new Error("This operation was aborted")){this.signal.reason=this.signal.reason||e,this.signal.aborted=!0,this.signal.dispatchEvent({type:"abort",target:this.signal})}},Ss=typeof AbortSignal=="function",As=typeof Ee.AbortSignal=="function",ft=Ss?AbortSignal:As?Ee.AbortController:class{constructor(){this.reason=void 0,this.aborted=!1,this._listeners=[]}dispatchEvent(e){e.type==="abort"&&(this.aborted=!0,this.onabort(e),this._listeners.forEach(t=>t(e),this))}onabort(){}addEventListener(e,t){e==="abort"&&this._listeners.push(t)}removeEventListener(e,t){e==="abort"&&(this._listeners=this._listeners.filter(s=>s!==t))}},Je=new Set,qe=(r,e)=>{let t=`LRU_CACHE_OPTION_${r}`;Le(t)&&Ze(t,`${r} option`,`options.${e}`,he)},Ve=(r,e)=>{let t=`LRU_CACHE_METHOD_${r}`;if(Le(t)){let{prototype:s}=he,{get:i}=Object.getOwnPropertyDescriptor(s,r);Ze(t,`${r} method`,`cache.${e}()`,i)}},Es=(r,e)=>{let t=`LRU_CACHE_PROPERTY_${r}`;if(Le(t)){let{prototype:s}=he,{get:i}=Object.getOwnPropertyDescriptor(s,r);Ze(t,`${r} property`,`cache.${e}`,i)}},ut=(...r)=>{typeof process=="object"&&process&&typeof process.emitWarning=="function"?process.emitWarning(...r):console.error(...r)},Le=r=>!Je.has(r),Ze=(r,e,t,s)=>{Je.add(r);let i=`The ${e} is deprecated. Please use ${t} instead.`;ut(i,"DeprecationWarning",r,s)},W=r=>r&&r===Math.floor(r)&&r>0&&isFinite(r),pt=r=>W(r)?r<=Math.pow(2,8)?Uint8Array:r<=Math.pow(2,16)?Uint16Array:r<=Math.pow(2,32)?Uint32Array:r<=Number.MAX_SAFE_INTEGER?ce:null:null,ce=class extends Array{constructor(e){super(e),this.fill(0)}},Ge=class{constructor(e){if(e===0)return[];let t=pt(e);this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}},he=class r{constructor(e={}){let{max:t=0,ttl:s,ttlResolution:i=1,ttlAutopurge:n,updateAgeOnGet:o,updateAgeOnHas:c,allowStale:f,dispose:l,disposeAfter:a,noDisposeOnSet:h,noUpdateTTL:d,maxSize:m=0,maxEntrySize:b=0,sizeCalculation:g,fetchMethod:u,fetchContext:_,noDeleteOnFetchRejection:E,noDeleteOnStaleGet:v,allowStaleOnFetchRejection:T,allowStaleOnFetchAbort:p,ignoreFetchAbort:y}=e,{length:w,maxAge:x,stale:$}=e instanceof r?{}:e;if(t!==0&&!W(t))throw new TypeError("max option must be a nonnegative integer");let S=t?pt(t):Array;if(!S)throw new Error("invalid max value: "+t);if(this.max=t,this.maxSize=m,this.maxEntrySize=b||this.maxSize,this.sizeCalculation=g||w,this.sizeCalculation){if(!this.maxSize&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(this.fetchMethod=u||null,this.fetchMethod&&typeof this.fetchMethod!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.fetchContext=_,!this.fetchMethod&&_!==void 0)throw new TypeError("cannot set fetchContext without fetchMethod");if(this.keyMap=new Map,this.keyList=new Array(t).fill(null),this.valList=new Array(t).fill(null),this.next=new S(t),this.prev=new S(t),this.head=0,this.tail=0,this.free=new Ge(t),this.initialFill=1,this.size=0,typeof l=="function"&&(this.dispose=l),typeof a=="function"?(this.disposeAfter=a,this.disposed=[]):(this.disposeAfter=null,this.disposed=null),this.noDisposeOnSet=!!h,this.noUpdateTTL=!!d,this.noDeleteOnFetchRejection=!!E,this.allowStaleOnFetchRejection=!!T,this.allowStaleOnFetchAbort=!!p,this.ignoreFetchAbort=!!y,this.maxEntrySize!==0){if(this.maxSize!==0&&!W(this.maxSize))throw new TypeError("maxSize must be a positive integer if specified");if(!W(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.initializeSizeTracking()}if(this.allowStale=!!f||!!$,this.noDeleteOnStaleGet=!!v,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!c,this.ttlResolution=W(i)||i===0?i:1,this.ttlAutopurge=!!n,this.ttl=s||x||0,this.ttl){if(!W(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.initializeTTLTracking()}if(this.max===0&&this.ttl===0&&this.maxSize===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.max&&!this.maxSize){let z="LRU_CACHE_UNBOUNDED";Le(z)&&(Je.add(z),ut("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",z,r))}$&&qe("stale","allowStale"),x&&qe("maxAge","ttl"),w&&qe("length","sizeCalculation")}getRemainingTTL(e){return this.has(e,{updateAgeOnHas:!1})?1/0:0}initializeTTLTracking(){this.ttls=new ce(this.max),this.starts=new ce(this.max),this.setItemTTL=(s,i,n=ue.now())=>{if(this.starts[s]=i!==0?n:0,this.ttls[s]=i,i!==0&&this.ttlAutopurge){let o=setTimeout(()=>{this.isStale(s)&&this.delete(this.keyList[s])},i+1);o.unref&&o.unref()}},this.updateItemAge=s=>{this.starts[s]=this.ttls[s]!==0?ue.now():0},this.statusTTL=(s,i)=>{s&&(s.ttl=this.ttls[i],s.start=this.starts[i],s.now=e||t(),s.remainingTTL=s.now+s.ttl-s.start)};let e=0,t=()=>{let s=ue.now();if(this.ttlResolution>0){e=s;let i=setTimeout(()=>e=0,this.ttlResolution);i.unref&&i.unref()}return s};this.getRemainingTTL=s=>{let i=this.keyMap.get(s);return i===void 0?0:this.ttls[i]===0||this.starts[i]===0?1/0:this.starts[i]+this.ttls[i]-(e||t())},this.isStale=s=>this.ttls[s]!==0&&this.starts[s]!==0&&(e||t())-this.starts[s]>this.ttls[s]}updateItemAge(e){}statusTTL(e,t){}setItemTTL(e,t,s){}isStale(e){return!1}initializeSizeTracking(){this.calculatedSize=0,this.sizes=new ce(this.max),this.removeItemSize=e=>{this.calculatedSize-=this.sizes[e],this.sizes[e]=0},this.requireSize=(e,t,s,i)=>{if(this.isBackgroundFetch(t))return 0;if(!W(s))if(i){if(typeof i!="function")throw new TypeError("sizeCalculation must be a function");if(s=i(t,e),!W(s))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return s},this.addItemSize=(e,t,s)=>{if(this.sizes[e]=t,this.maxSize){let i=this.maxSize-this.sizes[e];for(;this.calculatedSize>i;)this.evict(!0)}this.calculatedSize+=this.sizes[e],s&&(s.entrySize=t,s.totalCalculatedSize=this.calculatedSize)}}removeItemSize(e){}addItemSize(e,t){}requireSize(e,t,s,i){if(s||i)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache")}*indexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.tail;!(!this.isValidIndex(t)||((e||!this.isStale(t))&&(yield t),t===this.head));)t=this.prev[t]}*rindexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.head;!(!this.isValidIndex(t)||((e||!this.isStale(t))&&(yield t),t===this.tail));)t=this.next[t]}isValidIndex(e){return e!==void 0&&this.keyMap.get(this.keyList[e])===e}*entries(){for(let e of this.indexes())this.valList[e]!==void 0&&this.keyList[e]!==void 0&&!this.isBackgroundFetch(this.valList[e])&&(yield[this.keyList[e],this.valList[e]])}*rentries(){for(let e of this.rindexes())this.valList[e]!==void 0&&this.keyList[e]!==void 0&&!this.isBackgroundFetch(this.valList[e])&&(yield[this.keyList[e],this.valList[e]])}*keys(){for(let e of this.indexes())this.keyList[e]!==void 0&&!this.isBackgroundFetch(this.valList[e])&&(yield this.keyList[e])}*rkeys(){for(let e of this.rindexes())this.keyList[e]!==void 0&&!this.isBackgroundFetch(this.valList[e])&&(yield this.keyList[e])}*values(){for(let e of this.indexes())this.valList[e]!==void 0&&!this.isBackgroundFetch(this.valList[e])&&(yield this.valList[e])}*rvalues(){for(let e of this.rindexes())this.valList[e]!==void 0&&!this.isBackgroundFetch(this.valList[e])&&(yield this.valList[e])}[Symbol.iterator](){return this.entries()}find(e,t){for(let s of this.indexes()){let i=this.valList[s],n=this.isBackgroundFetch(i)?i.__staleWhileFetching:i;if(n!==void 0&&e(n,this.keyList[s],this))return this.get(this.keyList[s],t)}}forEach(e,t=this){for(let s of this.indexes()){let i=this.valList[s],n=this.isBackgroundFetch(i)?i.__staleWhileFetching:i;n!==void 0&&e.call(t,n,this.keyList[s],this)}}rforEach(e,t=this){for(let s of this.rindexes()){let i=this.valList[s],n=this.isBackgroundFetch(i)?i.__staleWhileFetching:i;n!==void 0&&e.call(t,n,this.keyList[s],this)}}get prune(){return Ve("prune","purgeStale"),this.purgeStale}purgeStale(){let e=!1;for(let t of this.rindexes({allowStale:!0}))this.isStale(t)&&(this.delete(this.keyList[t]),e=!0);return e}dump(){let e=[];for(let t of this.indexes({allowStale:!0})){let s=this.keyList[t],i=this.valList[t],n=this.isBackgroundFetch(i)?i.__staleWhileFetching:i;if(n===void 0)continue;let o={value:n};if(this.ttls){o.ttl=this.ttls[t];let c=ue.now()-this.starts[t];o.start=Math.floor(Date.now()-c)}this.sizes&&(o.size=this.sizes[t]),e.unshift([s,o])}return e}load(e){this.clear();for(let[t,s]of e){if(s.start){let i=Date.now()-s.start;s.start=ue.now()-i}this.set(t,s.value,s)}}dispose(e,t,s){}set(e,t,{ttl:s=this.ttl,start:i,noDisposeOnSet:n=this.noDisposeOnSet,size:o=0,sizeCalculation:c=this.sizeCalculation,noUpdateTTL:f=this.noUpdateTTL,status:l}={}){if(o=this.requireSize(e,t,o,c),this.maxEntrySize&&o>this.maxEntrySize)return l&&(l.set="miss",l.maxEntrySizeExceeded=!0),this.delete(e),this;let a=this.size===0?void 0:this.keyMap.get(e);if(a===void 0)a=this.newIndex(),this.keyList[a]=e,this.valList[a]=t,this.keyMap.set(e,a),this.next[this.tail]=a,this.prev[a]=this.tail,this.tail=a,this.size++,this.addItemSize(a,o,l),l&&(l.set="add"),f=!1;else{this.moveToTail(a);let h=this.valList[a];if(t!==h){if(this.isBackgroundFetch(h)?h.__abortController.abort(new Error("replaced")):n||(this.dispose(h,e,"set"),this.disposeAfter&&this.disposed.push([h,e,"set"])),this.removeItemSize(a),this.valList[a]=t,this.addItemSize(a,o,l),l){l.set="replace";let d=h&&this.isBackgroundFetch(h)?h.__staleWhileFetching:h;d!==void 0&&(l.oldValue=d)}}else l&&(l.set="update")}if(s!==0&&this.ttl===0&&!this.ttls&&this.initializeTTLTracking(),f||this.setItemTTL(a,s,i),this.statusTTL(l,a),this.disposeAfter)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return this}newIndex(){return this.size===0?this.tail:this.size===this.max&&this.max!==0?this.evict(!1):this.free.length!==0?this.free.pop():this.initialFill++}pop(){if(this.size){let e=this.valList[this.head];return this.evict(!0),e}}evict(e){let t=this.head,s=this.keyList[t],i=this.valList[t];return this.isBackgroundFetch(i)?i.__abortController.abort(new Error("evicted")):(this.dispose(i,s,"evict"),this.disposeAfter&&this.disposed.push([i,s,"evict"])),this.removeItemSize(t),e&&(this.keyList[t]=null,this.valList[t]=null,this.free.push(t)),this.head=this.next[t],this.keyMap.delete(s),this.size--,t}has(e,{updateAgeOnHas:t=this.updateAgeOnHas,status:s}={}){let i=this.keyMap.get(e);if(i!==void 0)if(this.isStale(i))s&&(s.has="stale",this.statusTTL(s,i));else return t&&this.updateItemAge(i),s&&(s.has="hit"),this.statusTTL(s,i),!0;else s&&(s.has="miss");return!1}peek(e,{allowStale:t=this.allowStale}={}){let s=this.keyMap.get(e);if(s!==void 0&&(t||!this.isStale(s))){let i=this.valList[s];return this.isBackgroundFetch(i)?i.__staleWhileFetching:i}}backgroundFetch(e,t,s,i){let n=t===void 0?void 0:this.valList[t];if(this.isBackgroundFetch(n))return n;let o=new Ee;s.signal&&s.signal.addEventListener("abort",()=>o.abort(s.signal.reason));let c={signal:o.signal,options:s,context:i},f=(m,b=!1)=>{let{aborted:g}=o.signal,u=s.ignoreFetchAbort&&m!==void 0;return s.status&&(g&&!b?(s.status.fetchAborted=!0,s.status.fetchError=o.signal.reason,u&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),g&&!u&&!b?a(o.signal.reason):(this.valList[t]===d&&(m===void 0?d.__staleWhileFetching?this.valList[t]=d.__staleWhileFetching:this.delete(e):(s.status&&(s.status.fetchUpdated=!0),this.set(e,m,c.options))),m)},l=m=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=m),a(m)),a=m=>{let{aborted:b}=o.signal,g=b&&s.allowStaleOnFetchAbort,u=g||s.allowStaleOnFetchRejection,_=u||s.noDeleteOnFetchRejection;if(this.valList[t]===d&&(!_||d.__staleWhileFetching===void 0?this.delete(e):g||(this.valList[t]=d.__staleWhileFetching)),u)return s.status&&d.__staleWhileFetching!==void 0&&(s.status.returnedStale=!0),d.__staleWhileFetching;if(d.__returned===d)throw m},h=(m,b)=>{this.fetchMethod(e,n,c).then(g=>m(g),b),o.signal.addEventListener("abort",()=>{(!s.ignoreFetchAbort||s.allowStaleOnFetchAbort)&&(m(),s.allowStaleOnFetchAbort&&(m=g=>f(g,!0)))})};s.status&&(s.status.fetchDispatched=!0);let d=new Promise(h).then(f,l);return d.__abortController=o,d.__staleWhileFetching=n,d.__returned=null,t===void 0?(this.set(e,d,{...c.options,status:void 0}),t=this.keyMap.get(e)):this.valList[t]=d,d}isBackgroundFetch(e){return e&&typeof e=="object"&&typeof e.then=="function"&&Object.prototype.hasOwnProperty.call(e,"__staleWhileFetching")&&Object.prototype.hasOwnProperty.call(e,"__returned")&&(e.__returned===e||e.__returned===null)}async fetch(e,{allowStale:t=this.allowStale,updateAgeOnGet:s=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:n=this.ttl,noDisposeOnSet:o=this.noDisposeOnSet,size:c=0,sizeCalculation:f=this.sizeCalculation,noUpdateTTL:l=this.noUpdateTTL,noDeleteOnFetchRejection:a=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:h=this.allowStaleOnFetchRejection,ignoreFetchAbort:d=this.ignoreFetchAbort,allowStaleOnFetchAbort:m=this.allowStaleOnFetchAbort,fetchContext:b=this.fetchContext,forceRefresh:g=!1,status:u,signal:_}={}){if(!this.fetchMethod)return u&&(u.fetch="get"),this.get(e,{allowStale:t,updateAgeOnGet:s,noDeleteOnStaleGet:i,status:u});let E={allowStale:t,updateAgeOnGet:s,noDeleteOnStaleGet:i,ttl:n,noDisposeOnSet:o,size:c,sizeCalculation:f,noUpdateTTL:l,noDeleteOnFetchRejection:a,allowStaleOnFetchRejection:h,allowStaleOnFetchAbort:m,ignoreFetchAbort:d,status:u,signal:_},v=this.keyMap.get(e);if(v===void 0){u&&(u.fetch="miss");let T=this.backgroundFetch(e,v,E,b);return T.__returned=T}else{let T=this.valList[v];if(this.isBackgroundFetch(T)){let $=t&&T.__staleWhileFetching!==void 0;return u&&(u.fetch="inflight",$&&(u.returnedStale=!0)),$?T.__staleWhileFetching:T.__returned=T}let p=this.isStale(v);if(!g&&!p)return u&&(u.fetch="hit"),this.moveToTail(v),s&&this.updateItemAge(v),this.statusTTL(u,v),T;let y=this.backgroundFetch(e,v,E,b),w=y.__staleWhileFetching!==void 0,x=w&&t;return u&&(u.fetch=w&&p?"stale":"refresh",x&&p&&(u.returnedStale=!0)),x?y.__staleWhileFetching:y.__returned=y}}get(e,{allowStale:t=this.allowStale,updateAgeOnGet:s=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:n}={}){let o=this.keyMap.get(e);if(o!==void 0){let c=this.valList[o],f=this.isBackgroundFetch(c);return this.statusTTL(n,o),this.isStale(o)?(n&&(n.get="stale"),f?(n&&(n.returnedStale=t&&c.__staleWhileFetching!==void 0),t?c.__staleWhileFetching:void 0):(i||this.delete(e),n&&(n.returnedStale=t),t?c:void 0)):(n&&(n.get="hit"),f?c.__staleWhileFetching:(this.moveToTail(o),s&&this.updateItemAge(o),c))}else n&&(n.get="miss")}connect(e,t){this.prev[t]=e,this.next[e]=t}moveToTail(e){e!==this.tail&&(e===this.head?this.head=this.next[e]:this.connect(this.prev[e],this.next[e]),this.connect(this.tail,e),this.tail=e)}get del(){return Ve("del","delete"),this.delete}delete(e){let t=!1;if(this.size!==0){let s=this.keyMap.get(e);if(s!==void 0)if(t=!0,this.size===1)this.clear();else{this.removeItemSize(s);let i=this.valList[s];this.isBackgroundFetch(i)?i.__abortController.abort(new Error("deleted")):(this.dispose(i,e,"delete"),this.disposeAfter&&this.disposed.push([i,e,"delete"])),this.keyMap.delete(e),this.keyList[s]=null,this.valList[s]=null,s===this.tail?this.tail=this.prev[s]:s===this.head?this.head=this.next[s]:(this.next[this.prev[s]]=this.next[s],this.prev[this.next[s]]=this.prev[s]),this.size--,this.free.push(s)}}if(this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return t}clear(){for(let e of this.rindexes({allowStale:!0})){let t=this.valList[e];if(this.isBackgroundFetch(t))t.__abortController.abort(new Error("deleted"));else{let s=this.keyList[e];this.dispose(t,s,"delete"),this.disposeAfter&&this.disposed.push([t,s,"delete"])}}if(this.keyMap.clear(),this.valList.fill(null),this.keyList.fill(null),this.ttls&&(this.ttls.fill(0),this.starts.fill(0)),this.sizes&&this.sizes.fill(0),this.head=0,this.tail=0,this.initialFill=1,this.free.length=0,this.calculatedSize=0,this.size=0,this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift())}get reset(){return Ve("reset","clear"),this.clear}get length(){return Es("length","size"),this.size}static get AbortController(){return Ee}static get AbortSignal(){return ft}},xe=he;import{PassThrough as wt,Readable as U}from"stream";import{types as Is}from"util";var j=class extends Error{constructor(e,t){super(e),this.type=t}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}},R=class extends j{constructor(e,t,s){super(e,t),s&&(this.code=s.code,this.errno=s.errno,this.erroredSysCall=s.syscall)}},te=class extends j{constructor(e,t="aborted"){super(e,t)}};var gt=Q(ee(),1);import{constants as Ls}from"buffer";import{pipeline as Fe,PassThrough as xs}from"stream";import{promisify as Fs}from"util";import{createGunzip as Ps,createInflate as $s,createBrotliDecompress as Os,constants as Hs}from"zlib";var zs=(0,gt.default)("adobe/fetch:utils"),{MAX_LENGTH:ks}=Ls,{Z_SYNC_FLUSH:mt}=Hs,Rs=Fs(Fe),Ns=(r,e)=>r===204||r===304||+e["content-length"]==0?!1:/^\s*(?:(x-)?deflate|(x-)?gzip|br)\s*$/.test(e["content-encoding"]),$e=(r,e,t,s)=>{if(!Ns(r,e))return t;let i=n=>{n&&(zs(`encountered error while decoding stream: ${n}`),s(n))};switch(e["content-encoding"].trim()){case"gzip":case"x-gzip":return Fe(t,Ps({flush:mt,finishFlush:mt}),i);case"deflate":case"x-deflate":return Fe(t,$s(),i);case"br":return Fe(t,Os(),i);default:return t}},q=r=>{if(!r||typeof r!="object"||Object.prototype.toString.call(r)!=="[object Object]")return!1;if(Object.getPrototypeOf(r)===null)return!0;let e=r;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(r)===e},Pe=(r,e)=>{if(Buffer.isBuffer(r))return r.length;switch(typeof r){case"string":return r.length*2;case"boolean":return 4;case"number":return 8;case"symbol":return Symbol.keyFor(r)?Symbol.keyFor(r).length*2:(r.toString().length-8)*2;case"object":return Array.isArray(r)?Bs(r,e):Us(r,e);default:return 0}},Bs=(r,e)=>(e.add(r),r.map(t=>e.has(t)?0:Pe(t,e)).reduce((t,s)=>t+s,0)),Us=(r,e)=>{if(r==null)return 0;e.add(r);let t=0,s=[];for(let i in r)s.push(i);return s.push(...Object.getOwnPropertySymbols(r)),s.forEach(i=>{if(t+=Pe(i,e),typeof r[i]=="object"&&r[i]!==null){if(e.has(r[i]))return;e.add(r[i])}t+=Pe(r[i],e)}),t},yt=r=>Pe(r,new WeakSet),bt=async r=>{let e=new xs,t=0,s=[];return e.on("data",i=>{if(t+i.length>ks)throw new Error("Buffer.constants.MAX_SIZE exceeded");s.push(i),t+=i.length}),await Rs(r,e),Buffer.concat(s,t)};var{isAnyArrayBuffer:Ct}=Is,Ms=Buffer.alloc(0),O=Symbol("Body internals"),Ds=r=>r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength),_t=async r=>{if(r[O].disturbed)throw new TypeError("Already read");if(r[O].error)throw new TypeError(`Stream had error: ${r[O].error.message}`);r[O].disturbed=!0;let{stream:e}=r[O];return e===null?Ms:bt(e)},I=class{constructor(e){let t;e==null?t=null:e instanceof URLSearchParams?t=U.from(e.toString()):e instanceof U?t=e:Buffer.isBuffer(e)?t=U.from(e):Ct(e)?t=U.from(Buffer.from(e)):typeof e=="string"||e instanceof String?t=U.from(e):t=U.from(String(e)),this[O]={stream:t,disturbed:!1,error:null},e instanceof U&&t.on("error",s=>{let i=s instanceof j?s:new R(`Invalid response body while trying to fetch ${this.url}: ${s.message}`,"system",s);this[O].error=i})}get body(){return this[O].stream}get bodyUsed(){return this[O].disturbed}async buffer(){return _t(this)}async arrayBuffer(){return Ds(await this.buffer())}async text(){return(await _t(this)).toString()}async json(){return JSON.parse(await this.text())}};Object.defineProperties(I.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}});var Oe=r=>{if(r[O].disturbed)throw new TypeError("Cannot clone: already read");let{stream:e}=r[O],t=e;if(e instanceof U){t=new wt;let s=new wt;e.pipe(t),e.pipe(s),r[O].stream=s}return t},He=r=>r===null?null:typeof r=="string"?"text/plain; charset=utf-8":r instanceof URLSearchParams?"application/x-www-form-urlencoded; charset=utf-8":Buffer.isBuffer(r)||Ct(r)||r instanceof U?null:"text/plain; charset=utf-8";import Ws from"http";var{validateHeaderName:js,validateHeaderValue:qs}=Ws,H=Symbol("Headers internals"),pe=r=>{let e=typeof r!="string"?String(r):r;return js(e),e.toLowerCase()},Tt=(r,e)=>{let t=typeof r!="string"?String(r):r;return qs(e,t),t},ze=class r{constructor(e={}){if(this[H]={map:new Map},e instanceof r)e[H].map.forEach((t,s)=>{this[H].map.set(s,Array.isArray(t)?[...t]:t)});else if(Array.isArray(e))e.forEach(([t,s])=>{Array.isArray(s)?s.forEach(i=>{this.append(t,i)}):this.append(t,s)});else if(q(e))for(let[t,s]of Object.entries(e))Array.isArray(s)?s.forEach(i=>{this.append(t,i)}):this.set(t,s)}set(e,t){this[H].map.set(pe(e),Tt(t,e))}has(e){return this[H].map.has(pe(e))}get(e){let t=this[H].map.get(pe(e));return t===void 0?null:Array.isArray(t)?t.join(", "):t}append(e,t){let s=pe(e),i=Tt(t,e),n=this[H].map.get(s);Array.isArray(n)?n.push(i):n===void 0?this[H].map.set(s,i):this[H].map.set(s,[n,i])}delete(e){this[H].map.delete(pe(e))}forEach(e,t){for(let s of this.keys())e.call(t,this.get(s),s)}keys(){return Array.from(this[H].map.keys()).sort()}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return this.constructor.name}plain(){return[...this.keys()].reduce((e,t)=>(e[t]=this.get(t),e),{})}raw(){return Object.fromEntries(this[H].map)}};Object.defineProperties(ze.prototype,["append","delete","entries","forEach","get","has","keys","set","values"].reduce((r,e)=>(r[e]={enumerable:!0},r),{}));var P=ze;import{EventEmitter as Vs}from"events";var N=Symbol("AbortSignal internals"),M=class{constructor(){this[N]={eventEmitter:new Vs,onabort:null,aborted:!1}}get aborted(){return this[N].aborted}get onabort(){return this[N].onabort}set onabort(e){this[N].onabort=e}get[Symbol.toStringTag](){return this.constructor.name}removeEventListener(e,t){this[N].eventEmitter.removeListener(e,t)}addEventListener(e,t){this[N].eventEmitter.on(e,t)}dispatchEvent(e){let t={type:e,target:this},s=`on${e}`;typeof this[N][s]=="function"&&this[s](t),this[N].eventEmitter.emit(e,t)}fire(){this[N].aborted=!0,this.dispatchEvent("abort")}};Object.defineProperties(M.prototype,{addEventListener:{enumerable:!0},removeEventListener:{enumerable:!0},dispatchEvent:{enumerable:!0},aborted:{enumerable:!0},onabort:{enumerable:!0}});var me=class extends M{constructor(e){if(!Number.isInteger(e))throw new TypeError(`Expected an integer, got ${typeof e}`);super(),this[N].timerId=setTimeout(()=>{this.fire()},e)}clear(){clearTimeout(this[N].timerId)}};Object.defineProperties(me.prototype,{clear:{enumerable:!0}});var ke=Symbol("AbortController internals"),ge=class{constructor(){this[ke]={signal:new M}}get signal(){return this[ke].signal}get[Symbol.toStringTag](){return this.constructor.name}abort(){this[ke].signal.aborted||this[ke].signal.fire()}};Object.defineProperties(ge.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}});import{randomBytes as Gs}from"crypto";import{Readable as Js}from"stream";var Xe=r=>typeof r=="object"&&["arrayBuffer","stream","text","slice","constructor"].map(e=>typeof r[e]).filter(e=>e!=="function").length===0&&typeof r.type=="string"&&typeof r.size=="number"&&/^(Blob|File)$/.test(r[Symbol.toStringTag]),G=r=>r!=null&&typeof r=="object"&&["append","delete","get","getAll","has","set","keys","values","entries","constructor"].map(e=>typeof r[e]).filter(e=>e!=="function").length===0&&r[Symbol.toStringTag]==="FormData",vt=r=>`--${r}--\r
\r
`,St=(r,e,t)=>{let s="";return s+=`--${r}\r
`,s+=`Content-Disposition: form-data; name="${e}"`,Xe(t)&&(s+=`; filename="${t.name}"\r
`,s+=`Content-Type: ${t.type||"application/octet-stream"}`),`${s}\r
\r
`};async function*Zs(r,e){for(let[t,s]of r)yield St(e,t,s),Xe(s)?yield*s.stream():yield s,yield`\r
`;yield vt(e)}var Xs=(r,e)=>{let t=0;for(let[s,i]of r)t+=Buffer.byteLength(St(e,s,i)),t+=Xe(i)?i.size:Buffer.byteLength(String(i)),t+=Buffer.byteLength(`\r
`);return t+=Buffer.byteLength(vt(e)),t},V=class{constructor(e){this.fd=e,this.boundary=Gs(8).toString("hex")}length(){return typeof this._length>"u"&&(this._length=Xs(this.fd,this.boundary)),this._length}contentType(){return`multipart/form-data; boundary=${this.boundary}`}stream(){return Js.from(Zs(this.fd,this.boundary))}};var Ys=20,J=Symbol("Request internals"),Re=class r extends I{constructor(e,t={}){let s=e instanceof r?e:null,i=s?new URL(s.url):new URL(e),n=t.method||s&&s.method||"GET";if(n=n.toUpperCase(),(t.body!=null||s&&s.body!==null)&&["GET","HEAD"].includes(n))throw new TypeError("Request with GET/HEAD method cannot have body");let o=t.body||(s&&s.body?Oe(s):null),c=new P(t.headers||s&&s.headers||{});if(G(o)&&!c.has("content-type")){let h=new V(o);o=h.stream(),c.set("content-type",h.contentType()),!c.has("transfer-encoding")&&!c.has("content-length")&&c.set("content-length",h.length())}if(!c.has("content-type"))if(q(o))o=JSON.stringify(o),c.set("content-type","application/json");else{let h=He(o);h&&c.set("content-type",h)}super(o);let f=s?s.signal:null;if("signal"in t&&(f=t.signal),f&&!(f instanceof M))throw new TypeError("signal needs to be an instance of AbortSignal");let l=t.redirect||s&&s.redirect||"follow";if(!["follow","error","manual"].includes(l))throw new TypeError(`'${l}' is not a valid redirect option`);let a=t.cache||s&&s.cache||"default";if(!["default","no-store","reload","no-cache","force-cache","only-if-cached"].includes(a))throw new TypeError(`'${a}' is not a valid cache option`);this[J]={init:{...t},method:n,redirect:l,cache:a,headers:c,parsedURL:i,signal:f},t.follow===void 0?!s||s.follow===void 0?this.follow=Ys:this.follow=s.follow:this.follow=t.follow,this.counter=t.counter||s&&s.counter||0,t.compress===void 0?!s||s.compress===void 0?this.compress=!0:this.compress=s.compress:this.compress=t.compress,t.decode===void 0?!s||s.decode===void 0?this.decode=!0:this.decode=s.decode:this.decode=t.decode}get method(){return this[J].method}get url(){return this[J].parsedURL.toString()}get headers(){return this[J].headers}get redirect(){return this[J].redirect}get cache(){return this[J].cache}get signal(){return this[J].signal}clone(){return new r(this)}get init(){return this[J].init}get[Symbol.toStringTag](){return this.constructor.name}};Object.defineProperties(Re.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},cache:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}});var Z=Re;var B=Symbol("Response internals"),Ne=class r extends I{constructor(e=null,t={}){let s=new P(t.headers),i=e;if(G(i)&&!s.has("content-type")){let n=new V(i);i=n.stream(),s.set("content-type",n.contentType()),!s.has("transfer-encoding")&&!s.has("content-length")&&s.set("content-length",n.length())}if(i!==null&&!s.has("content-type"))if(q(i))i=JSON.stringify(i),s.set("content-type","application/json");else{let n=He(i);n&&s.set("content-type",n)}super(i),this[B]={url:t.url,status:t.status||200,statusText:t.statusText||"",headers:s,httpVersion:t.httpVersion,decoded:t.decoded,counter:t.counter}}get url(){return this[B].url||""}get status(){return this[B].status}get statusText(){return this[B].statusText}get ok(){return this[B].status>=200&&this[B].status<300}get redirected(){return this[B].counter>0}get headers(){return this[B].headers}get httpVersion(){return this[B].httpVersion}get decoded(){return this[B].decoded}static redirect(e,t=302){if(![301,302,303,307,308].includes(t))throw new RangeError("Invalid status code");return new r(null,{headers:{location:new URL(e).toString()},status:t})}clone(){if(this.bodyUsed)throw new TypeError("Cannot clone: already read");return new r(Oe(this),{...this[B]})}get[Symbol.toStringTag](){return this.constructor.name}};Object.defineProperties(Ne.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});var le=Ne;var Ft=Q(Et(),1);var Lt=r=>({url:r.url,method:r.method,headers:r.headers.plain()}),xt=r=>({status:r.status,headers:r.headers.plain()}),Qe=class{constructor(e,t,s){this.policy=new Ft.default(Lt(e),xt(t),s)}storable(){return this.policy.storable()}satisfiesWithoutRevalidation(e){return this.policy.satisfiesWithoutRevalidation(Lt(e))}responseHeaders(e){return new P(this.policy.responseHeaders(xt(e)))}timeToLive(){return this.policy.timeToLive()}},Pt=Qe;import{Readable as nr}from"stream";var X=Symbol("CacheableResponse internals"),or=r=>r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength),Ke=class r extends le{constructor(e,t){super(e,t);let s=new P(t.headers);this[X]={headers:s,bufferedBody:e}}get headers(){return this[X].headers}set headers(e){if(e instanceof P)this[X].headers=e;else throw new TypeError("instance of Headers expected")}get body(){return nr.from(this[X].bufferedBody)}get bodyUsed(){return!1}async buffer(){return this[X].bufferedBody}async arrayBuffer(){return or(this[X].bufferedBody)}async text(){return this[X].bufferedBody.toString()}async json(){return JSON.parse(await this.text())}clone(){let{url:e,status:t,statusText:s,headers:i,httpVersion:n,decoded:o,counter:c}=this;return new r(this[X].bufferedBody,{url:e,status:t,statusText:s,headers:i,httpVersion:n,decoded:o,counter:c})}get[Symbol.toStringTag](){return this.constructor.name}},ar=async r=>{let e=await r.buffer(),{url:t,status:s,statusText:i,headers:n,httpVersion:o,decoded:c,redirected:f}=r;return new Ke(e,{url:t,status:s,statusText:i,headers:n,httpVersion:o,decoded:c,counter:f?1:0})},$t=ar;var jt=Q(ee(),1);import{createRequire as Ar}from"module";import{types as Er}from"util";import{Readable as Lr}from"stream";import xr from"tls";var It=Q(ee(),1);var L=class extends Error{get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}};var zt=Q(ee(),1);import Ot from"http";import Ht from"https";import{Readable as cr}from"stream";var D=(0,zt.default)("adobe/fetch:h1"),hr=(r,e)=>{let{h1:t,options:{h1:s,rejectUnauthorized:i}}=r;return e==="https:"?t.httpsAgent?t.httpsAgent:s||typeof i=="boolean"?(t.httpsAgent=new Ht.Agent(typeof i=="boolean"?{...s||{},rejectUnauthorized:i}:s),t.httpsAgent):void 0:t.httpAgent?t.httpAgent:s?(t.httpAgent=new Ot.Agent(s),t.httpAgent):void 0},lr=r=>{r.h1={}},dr=async({h1:r})=>{r.httpAgent&&(D("resetContext: destroying httpAgent"),r.httpAgent.destroy(),delete r.httpAgent),r.httpsAgent&&(D("resetContext: destroying httpsAgent"),r.httpsAgent.destroy(),delete r.httpsAgent)},fr=(r,e,t)=>{let{statusCode:s,statusMessage:i,httpVersion:n,httpVersionMajor:o,httpVersionMinor:c,headers:f}=r,l=e?$e(s,f,r,t):r;return{statusCode:s,statusText:i,httpVersion:n,httpVersionMajor:o,httpVersionMinor:c,headers:f,readable:l,decoded:!!(e&&l!==r)}},ur=async(r,e,t)=>{let{request:s}=e.protocol==="https:"?Ht:Ot,i=hr(r,e.protocol),n={...t,agent:i},{socket:o,body:c}=n;return o&&(delete n.socket,o.assigned||(o.assigned=!0,i?n.agent=new Proxy(i,{get:(f,l)=>l==="createConnection"&&!o.inUse?(a,h)=>{D(`agent reusing socket #${o.id} (${o.servername})`),o.inUse=!0,h(null,o)}:f[l]}):n.createConnection=(f,l)=>{D(`reusing socket #${o.id} (${o.servername})`),o.inUse=!0,l(null,o)})),new Promise((f,l)=>{D(`${n.method} ${e.href}`);let a,{signal:h}=n,d=()=>{h.removeEventListener("abort",d),o&&!o.inUse&&(D(`discarding redundant socket used for ALPN: #${o.id} ${o.servername}`),o.destroy()),l(new L),a&&a.abort()};if(h){if(h.aborted){l(new L);return}h.addEventListener("abort",d)}a=s(e,n),a.once("response",m=>{h&&h.removeEventListener("abort",d),o&&!o.inUse&&(D(`discarding redundant socket used for ALPN: #${o.id} ${o.servername}`),o.destroy()),f(fr(m,n.decode,l))}),a.once("error",m=>{h&&h.removeEventListener("abort",d),o&&!o.inUse&&(D(`discarding redundant socket used for ALPN: #${o.id} ${o.servername}`),o.destroy()),a.aborted||(D(`${n.method} ${e.href} failed with: ${m.message}`),a.abort(),l(m))}),c instanceof cr?c.pipe(a):(c&&a.write(c),a.end())})},Be={request:ur,setupContext:lr,resetContext:dr};var kt=Q(ee(),1);import{connect as pr,constants as mr}from"http2";import{Readable as gr}from"stream";var C=(0,kt.default)("adobe/fetch:h2"),{NGHTTP2_CANCEL:ye}=mr,yr=5*60*1e3,br=5e3,wr=r=>{r.h2={sessionCache:{}}},_r=async({h2:r})=>Promise.all(Object.values(r.sessionCache).map(e=>new Promise(t=>{e.on("close",t),C(`resetContext: destroying session (socket #${e.socket&&e.socket.id}, ${e.socket&&e.socket.servername})`),e.destroy()}))),Rt=(r,e,t,s=()=>{})=>{let i={...r},n=i[":status"];delete i[":status"];let o=t?$e(n,r,e,s):e;return{statusCode:n,statusText:"",httpVersion:"2.0",httpVersionMajor:2,httpVersionMinor:0,headers:i,readable:o,decoded:!!(t&&o!==e)}},Cr=(r,e,t,s,i,n)=>{let{options:{h2:{pushPromiseHandler:o,pushHandler:c,pushedStreamIdleTimeout:f=br}}}=r,l=i[":path"],a=`${e}${l}`;C(`received PUSH_PROMISE: ${a}, stream #${s.id}, headers: ${JSON.stringify(i)}, flags: ${n}`),o&&o(a,i,()=>{s.close(ye)}),s.on("push",(h,d)=>{C(`received push headers for ${e}${l}, stream #${s.id}, headers: ${JSON.stringify(h)}, flags: ${d}`),s.setTimeout(f,()=>{C(`closing pushed stream #${s.id} after ${f} ms of inactivity`),s.close(ye)}),c&&c(a,i,Rt(h,s,t))}),s.on("aborted",()=>{C(`pushed stream #${s.id} aborted`)}),s.on("error",h=>{C(`pushed stream #${s.id} encountered error: ${h}`)}),s.on("frameError",(h,d,m)=>{C(`pushed stream #${s.id} encountered frameError: type: ${h}, code: ${d}, id: ${m}`)})},Tr=async(r,e,t)=>{let{origin:s,pathname:i,search:n,hash:o}=e,c=`${i}${n}${o}`,{options:{h2:f={}},h2:{sessionCache:l}}=r,{idleSessionTimeout:a=yr,pushPromiseHandler:h,pushHandler:d}=f,m={...t},{method:b,headers:g,socket:u,body:_,decode:E}=m;return u&&delete m.socket,g.host&&(g[":authority"]=g.host,delete g.host),new Promise((v,T)=>{let p=l[s];if(!p||p.closed||p.destroyed){let S=!(r.options.rejectUnauthorized===!1||f.rejectUnauthorized===!1),z={...f,rejectUnauthorized:S};u&&!u.inUse&&(z.createConnection=()=>(C(`reusing socket #${u.id} (${u.servername})`),u.inUse=!0,u));let Ce=!!(h||d);p=pr(s,{...z,settings:{...z.settings,enablePush:Ce}}),p.setMaxListeners(1e3),p.setTimeout(a,()=>{C(`closing session ${s} after ${a} ms of inactivity`),p.close()}),p.once("connect",()=>{C(`session ${s} established`),C(`caching session ${s}`),l[s]=p}),p.on("localSettings",k=>{C(`session ${s} localSettings: ${JSON.stringify(k)}`)}),p.on("remoteSettings",k=>{C(`session ${s} remoteSettings: ${JSON.stringify(k)}`)}),p.once("close",()=>{C(`session ${s} closed`),l[s]===p&&(C(`discarding cached session ${s}`),delete l[s])}),p.once("error",k=>{C(`session ${s} encountered error: ${k}`),l[s]===p&&(C(`discarding cached session ${s}`),delete l[s])}),p.on("frameError",(k,fe,re)=>{C(`session ${s} encountered frameError: type: ${k}, code: ${fe}, id: ${re}`)}),p.once("goaway",(k,fe,re)=>{C(`session ${s} received GOAWAY frame: errorCode: ${k}, lastStreamID: ${fe}, opaqueData: ${re?re.toString():void 0}`)}),p.on("stream",(k,fe,re)=>{Cr(r,s,E,k,fe,re)})}else u&&u.id!==p.socket.id&&!u.inUse&&(C(`discarding redundant socket used for ALPN: #${u.id} ${u.servername}`),u.destroy());C(`${b} ${e.host}${c}`);let y,{signal:w}=m,x=()=>{w.removeEventListener("abort",x),T(new L),y&&y.close(ye)};if(w){if(w.aborted){T(new L);return}w.addEventListener("abort",x)}let $=S=>{C(`session ${s} encountered error during ${m.method} ${e.href}: ${S}`),T(S)};p.once("error",$),y=p.request({":method":b,":path":c,...g}),y.once("response",S=>{p.off("error",$),w&&w.removeEventListener("abort",x),v(Rt(S,y,m.decode,T))}),y.once("error",S=>{p.off("error",$),w&&w.removeEventListener("abort",x),y.rstCode!==ye&&(C(`${m.method} ${e.href} failed with: ${S.message}`),y.close(ye),T(S))}),y.once("frameError",(S,z,Ce)=>{p.off("error",$),C(`encountered frameError during ${m.method} ${e.href}: type: ${S}, code: ${z}, id: ${Ce}`)}),y.on("push",(S,z)=>{C(`received 'push' event: headers: ${JSON.stringify(S)}, flags: ${z}`)}),_ instanceof gr?_.pipe(y):(_&&y.write(_),y.end())})},be={request:Tr,setupContext:wr,resetContext:_r};import{EventEmitter as vr}from"events";var Sr=()=>{let r={},e=new vr;return e.setMaxListeners(0),{acquire:t=>new Promise(s=>{if(!r[t]){r[t]=!0,s();return}let i=n=>{r[t]||(r[t]=!0,e.removeListener(t,i),s(n))};e.on(t,i)}),release:(t,s)=>{Reflect.deleteProperty(r,t),setImmediate(()=>e.emit(t,s))}}},Nt=Sr;var Fr=Ar(import.meta.url),Pr=Fr("../../package.json"),{version:$r}=Pr,{isAnyArrayBuffer:Or}=Er,et=(0,It.default)("adobe/fetch:core"),Ue="h2",Ie="h2c",we="http/1.0",Y="http/1.1",Hr=100,zr=60*60*1e3,kr=[Ue,Y,we],Rr=`adobe-fetch/${$r}`,Nr={method:"GET",compress:!0,decode:!0},Bt=0,Ut=Nt(),Br=(r,e)=>new Promise((t,s)=>{let{signal:i}=e,n,o=()=>{i.removeEventListener("abort",o);let l=new L;s(l),n&&n.destroy(l)};if(i){if(i.aborted){s(new L);return}i.addEventListener("abort",o)}let c=+r.port||443,f=l=>{i&&i.removeEventListener("abort",o),l instanceof L||(et(`connecting to ${r.hostname}:${c} failed with: ${l.message}`),s(l))};n=xr.connect(c,r.hostname,e),n.once("secureConnect",()=>{i&&i.removeEventListener("abort",o),n.off("error",f),Bt+=1,n.id=Bt,et(`established TLS connection: #${n.id} (${n.servername})`),t(n)}),n.once("error",f)}),Ur=async(r,e)=>{let t=await Ut.acquire(r.origin);try{return t||(t=await Br(r,e)),t}finally{Ut.release(r.origin,t)}},Ir=async(r,e,t)=>{let s=`${e.protocol}//${e.host}`;switch(e.protocol){case"http:":return{protocol:Y};case"http2:":return{protocol:Ie};case"https:":break;default:throw new TypeError(`unsupported protocol: ${e.protocol}`)}if(r.alpnProtocols.length===1&&(r.alpnProtocols[0]===Y||r.alpnProtocols[0]===we))return{protocol:Y};let i=r.alpnCache.get(s);if(i)return{protocol:i};let{options:{rejectUnauthorized:n,h1:o={},h2:c={}}}=r,f=!(n===!1||o.rejectUnauthorized===!1||c.rejectUnauthorized===!1),l={servername:e.hostname,ALPNProtocols:r.alpnProtocols,signal:t,rejectUnauthorized:f},a=await Ur(e,l);return i=a.alpnProtocol,i||(i=Y),r.alpnCache.set(s,i),{protocol:i,socket:a}},Mr=r=>{let e={};return Object.keys(r).forEach(t=>{e[t.toLowerCase()]=r[t]}),e},Mt=async(r,e,t)=>{let s=new URL(e),i={...Nr,...t||{}};typeof i.method=="string"&&(i.method=i.method.toUpperCase()),i.headers=Mr(i.headers||{}),i.headers.host===void 0&&(i.headers.host=s.host),r.userAgent&&i.headers["user-agent"]===void 0&&(i.headers["user-agent"]=r.userAgent);let n;if(i.body instanceof URLSearchParams)n="application/x-www-form-urlencoded; charset=utf-8",i.body=i.body.toString();else if(G(i.body)){let l=new V(i.body);n=l.contentType(),i.body=l.stream(),i.headers["transfer-encoding"]===void 0&&i.headers["content-length"]===void 0&&(i.headers["content-length"]=String(l.length()))}else typeof i.body=="string"||i.body instanceof String?n="text/plain; charset=utf-8":q(i.body)?(i.body=JSON.stringify(i.body),n="application/json"):Or(i.body)&&(i.body=Buffer.from(i.body));i.headers["content-type"]===void 0&&n!==void 0&&(i.headers["content-type"]=n),i.body!=null&&(i.body instanceof Lr||(!(typeof i.body=="string"||i.body instanceof String)&&!Buffer.isBuffer(i.body)&&(i.body=String(i.body)),i.headers["transfer-encoding"]===void 0&&i.headers["content-length"]===void 0&&(i.headers["content-length"]=String(Buffer.isBuffer(i.body)?i.body.length:Buffer.byteLength(i.body,"utf-8"))))),i.headers.accept===void 0&&(i.headers.accept="*/*"),i.body==null&&["POST","PUT"].includes(i.method)&&(i.headers["content-length"]="0"),i.compress&&i.headers["accept-encoding"]===void 0&&(i.headers["accept-encoding"]="gzip,deflate,br");let{signal:o}=i,{protocol:c,socket:f=null}=await Ir(r,s,o);switch(et(`${s.host} -> ${c}`),c){case Ue:try{return await be.request(r,s,f?{...i,socket:f}:i)}catch(l){let{code:a,message:h}=l;throw a==="ERR_HTTP2_ERROR"&&h==="Protocol error"&&r.alpnCache.delete(`${s.protocol}//${s.host}`),l}case Ie:return be.request(r,new URL(`http://${s.host}${s.pathname}${s.hash}${s.search}`),f?{...i,socket:f}:i);case we:case Y:return Be.request(r,s,f?{...i,socket:f}:i);default:throw new TypeError(`unsupported protocol: ${c}`)}},Dt=async r=>(r.alpnCache.clear(),Promise.all([Be.resetContext(r),be.resetContext(r)])),Wt=r=>{let{options:{alpnProtocols:e=kr,alpnCacheTTL:t=zr,alpnCacheSize:s=Hr,userAgent:i=Rr}}=r;r.alpnProtocols=e,r.alpnCache=new xe({max:s,ttl:t}),r.userAgent=i,Be.setupContext(r),be.setupContext(r)};var Dr=(0,jt.default)("adobe/fetch:core"),tt=class r{constructor(e){this.options={...e||{}},Wt(this)}api(){return{request:async(e,t)=>this.request(e,t),context:(e={})=>new r(e).api(),reset:async()=>this.reset(),RequestAbortedError:L,ALPN_HTTP2:Ue,ALPN_HTTP2C:Ie,ALPN_HTTP1_1:Y,ALPN_HTTP1_0:we}}async request(e,t){return Mt(this,e,t)}async reset(){return Dr("resetting context"),Dt(this)}},qt=new tt().api();var{context:jr,RequestAbortedError:qr}=qt,st=(0,Vt.default)("adobe/fetch"),Gt=["GET","HEAD"],Vr=500,Gr=100*1024*1024,rt="push",Jt=async(r,e,t)=>{let{request:s}=r.context,i=e instanceof Z&&typeof t>"u"?e:new Z(e,t),{method:n,body:o,signal:c,compress:f,decode:l,follow:a,redirect:h,init:{body:d}}=i,m;if(c&&c.aborted){let p=new te("The operation was aborted.");throw i.init.body instanceof _e&&i.init.body.destroy(p),p}try{m=await s(i.url,{...t,method:n,headers:i.headers.plain(),body:d&&!(d instanceof _e)&&!G(d)?d:o,compress:f,decode:l,follow:a,redirect:h,signal:c})}catch(p){throw d instanceof _e&&d.destroy(p),p instanceof TypeError?p:p instanceof qr?new te("The operation was aborted."):new R(p.message,"system",p)}let b=()=>{c.removeEventListener("abort",b);let p=new te("The operation was aborted.");i.init.body instanceof _e&&i.init.body.destroy(p),m.readable.emit("error",p)};c&&c.addEventListener("abort",b);let{statusCode:g,statusText:u,httpVersion:_,headers:E,readable:v,decoded:T}=m;if([301,302,303,307,308].includes(g)){let{location:p}=E,y=p==null?null:new URL(p,i.url);switch(i.redirect){case"manual":break;case"error":throw c&&c.removeEventListener("abort",b),new R(`uri requested responds with a redirect, redirect mode is set to 'error': ${i.url}`,"no-redirect");case"follow":{if(y===null)break;if(!(y.protocol==="http:"||y.protocol==="https:"))throw new R("Cannot follow redirect with a non http location url","unsupported-redirect");if(i.counter>=i.follow)throw c&&c.removeEventListener("abort",b),new R(`maximum redirect reached at: ${i.url}`,"max-redirect");let w={headers:new P(i.headers),follow:i.follow,compress:i.compress,decode:i.decode,counter:i.counter+1,method:i.method,body:i.body,signal:i.signal};if(g!==303&&i.body&&i.init.body instanceof _e)throw c&&c.removeEventListener("abort",b),new R("Cannot follow redirect with body being a readable stream","unsupported-redirect");return(g===303&&!["GET","HEAD"].includes(i.method)||(g===301||g===302)&&i.method==="POST")&&(w.method="GET",w.body=void 0,w.headers.delete("content-length"),w.headers.delete("content-encoding"),w.headers.delete("content-language"),w.headers.delete("content-location"),w.headers.delete("content-type")),y.origin!==new URL(i.url).origin&&w.headers.delete("authorization"),c&&c.removeEventListener("abort",b),Jt(r,new Z(y,w))}default:}}return c&&(v.once("end",()=>{c.removeEventListener("abort",b)}),v.once("error",()=>{c.removeEventListener("abort",b)})),new le(v,{url:i.url,status:g,statusText:u,headers:E,httpVersion:_,decoded:T,counter:i.counter})},Zt=async(r,e,t)=>{if(r.options.maxCacheSize===0||!Gt.includes(e.method))return t;let s=new Pt(e,t,{shared:!1});if(s.storable()){let i=await $t(t);return r.cache.set(e.url,{policy:s,response:i},s.timeToLive()),i}else return t},Jr=async(r,e,t)=>{let s=new Z(e,t);if(r.options.maxCacheSize!==0&&Gt.includes(s.method)&&!["no-store","reload"].includes(s.cache)){let{policy:o,response:c}=r.cache.get(s.url)||{};if(o&&o.satisfiesWithoutRevalidation(s)){c.headers=new P(o.responseHeaders(c));let f=c.clone();return f.fromCache=!0,f}}let n=await Jt(r,s);return s.cache!=="no-store"?Zt(r,s,n):n},Zr=(r,e={})=>{let t=new URL(r);if(typeof e!="object"||Array.isArray(e))throw new TypeError("qs: object expected");return Object.entries(e).forEach(([s,i])=>{Array.isArray(i)?i.forEach(n=>t.searchParams.append(s,n)):t.searchParams.append(s,i)}),t.href},Xr=r=>new me(r),it=class r{constructor(e){this.options={...e};let{maxCacheSize:t}=this.options,s=typeof t=="number"&&t>=0?t:Gr,i=Vr;s===0&&(s=1,i=1);let n=({response:c},f)=>yt(c);this.cache=new xe({max:i,maxSize:s,sizeCalculation:n}),this.eventEmitter=new Wr,this.options.h2=this.options.h2||{},typeof this.options.h2.enablePush>"u"&&(this.options.h2.enablePush=!0);let{enablePush:o}=this.options.h2;o&&(this.options.h2.pushPromiseHandler=(c,f,l)=>{let a={...f};Object.keys(a).filter(h=>h.startsWith(":")).forEach(h=>delete a[h]),this.pushPromiseHandler(c,a,l)},this.options.h2.pushHandler=(c,f,l)=>{let a={...f};Object.keys(a).filter(_=>_.startsWith(":")).forEach(_=>delete a[_]);let{statusCode:h,statusText:d,httpVersion:m,headers:b,readable:g,decoded:u}=l;this.pushHandler(c,a,new le(g,{url:c,status:h,statusText:d,headers:b,httpVersion:m,decoded:u}))}),this.context=jr(this.options)}api(){return{fetch:async(e,t)=>this.fetch(e,t),Body:I,Headers:P,Request:Z,Response:le,AbortController:ge,AbortSignal:M,FetchBaseError:j,FetchError:R,AbortError:te,context:(e={})=>new r(e).api(),noCache:(e={})=>new r({...e,maxCacheSize:0}).api(),h1:(e={})=>new r({...e,alpnProtocols:[this.context.ALPN_HTTP1_1]}).api(),keepAlive:(e={})=>new r({...e,alpnProtocols:[this.context.ALPN_HTTP1_1],h1:{keepAlive:!0}}).api(),h1NoCache:(e={})=>new r({...e,maxCacheSize:0,alpnProtocols:[this.context.ALPN_HTTP1_1]}).api(),keepAliveNoCache:(e={})=>new r({...e,maxCacheSize:0,alpnProtocols:[this.context.ALPN_HTTP1_1],h1:{keepAlive:!0}}).api(),reset:async()=>this.context.reset(),onPush:e=>this.onPush(e),offPush:e=>this.offPush(e),createUrl:Zr,timeoutSignal:Xr,clearCache:()=>this.clearCache(),cacheStats:()=>this.cacheStats(),ALPN_HTTP2:this.context.ALPN_HTTP2,ALPN_HTTP2C:this.context.ALPN_HTTP2C,ALPN_HTTP1_1:this.context.ALPN_HTTP1_1,ALPN_HTTP1_0:this.context.ALPN_HTTP1_0}}async fetch(e,t){return Jr(this,e,t)}onPush(e){return this.eventEmitter.on(rt,e)}offPush(e){return this.eventEmitter.off(rt,e)}clearCache(){this.cache.clear()}cacheStats(){return{size:this.cache.calculatedSize,count:this.cache.size}}pushPromiseHandler(e,t,s){st(`received server push promise: ${e}, headers: ${JSON.stringify(t)}`);let i=new Z(e,{headers:t}),{policy:n}=this.cache.get(e)||{};n&&n.satisfiesWithoutRevalidation(i)&&(st(`already cached, reject push promise: ${e}, headers: ${JSON.stringify(t)}`),s())}async pushHandler(e,t,s){st(`caching resource pushed by server: ${e}, reqHeaders: ${JSON.stringify(t)}, status: ${s.status}, respHeaders: ${JSON.stringify(s.headers)}`);let i=await Zt(this,new Z(e,{headers:t}),s);this.eventEmitter.emit(rt,e,i)}},de=new it().api();var Yr={ALPN_HTTP2:de.ALPN_HTTP2,ALPN_HTTP2C:de.ALPN_HTTP2C,ALPN_HTTP1_1:de.ALPN_HTTP1_1,ALPN_HTTP1_0:de.ALPN_HTTP1_0},{fetch:Qr,context:Kr,reset:ei,noCache:ti,h1:si,keepAlive:ri,h1NoCache:ii,keepAliveNoCache:ni,cacheStats:oi,clearCache:ai,offPush:ci,onPush:hi,createUrl:li,timeoutSignal:di,Body:fi,Headers:ui,Request:pi,Response:mi,AbortController:gi,AbortError:yi,AbortSignal:bi,FetchBaseError:wi,FetchError:_i,ALPN_HTTP2:Ci,ALPN_HTTP2C:Ti,ALPN_HTTP1_1:vi,ALPN_HTTP1_0:Si}=de;var ao=nt;export{ao as default};
